!function(){"use strict";function e(e,t){var o,n,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,n=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(i=(i=r.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e],n=0}finally{o=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var t,o=function(){function t(e){var t=this;this.getDetailHtml=function(e){return"<div style='text-align: center; padding: 10px;'><div style='width: 100%; height: 180px; overflow: hidden;'><img style='max-width: 130px; width: auto;' src=' "+e.img+"' /></div><div style='max-height: 60px; margin: 5px; overflow: hidden;'><p style='height: 70px;display: -webkit-box;-webkit-line-clamp: 3;-webkit-box-orient: vertical;overflow: hidden !important;text-overflow: ellipsis;overflow-y: hidden;'>"+e.title+"</p></div><div><a style='width: 48%; font-size: 12px; display: inline-block;height: 30px;background: #00adff;text-decoration: none;line-height: 30px;color: white;border-radius: 5px;' href='https://www.flipkart.com"+e.url+"' target='_blank'>Buy</a><button style='display:inline-block;height: 30px;background: #ff9f00; width: 49%; margin-left: 5px; line-height: 30px;color: white;font-weight: bold;border-radius: 5px;' class='ads_add_to_cart' id='"+e.listingId+"' onClick="+t.handleAddToCart+">Add To Cart</button></div></div>"},this.showDetails=function(e,o,n,i){t.removeAllAdsDetail();var a=document.querySelector(t.selector),r=document.createElement("div"),s=document.createElement("div"),l=document.createElement("div");l.className="ads-detail-close",l.innerHTML="X",l.setAttribute("style","width: 20px;height: 20px;right: 5px;top: 5px;line-height: 12px;text-align: center;color: #616161;border: 1px solid #6f6f6f;position: absolute;font-size: 12px;font-weight: bold;padding: 3px;cursor: pointer;"),r.className="ads-detail",r.id=e+"-ads-detail",s.innerHTML=t.getDetailHtml(i),r.setAttribute("style","left: "+o+"px; top: "+n+"px;position: absolute;width: 200px;height: 310px;background: rgba(255, 255, 255, 0.8);padding: 5px;border-radius: 2px;overflow: hidden;box-shadow: 3px 0px 10px rgba(0,0,0,0.3);"),r.addEventListener("click",function(o){"ads-detail-close"===o.target.className&&t.removeAdsDetail(e)}),s.setAttribute("style","position: relative;background: white;"),s.append(l),r.appendChild(s),a.appendChild(r)},this.removeAllAdsDetail=function(){for(var e=document.querySelectorAll(t.selector+" .ads-detail"),o=0;o<e.length;o++)e[o]&&e[o].parentNode.removeChild(e[o])},this.removeAdsDetail=function(e){var o=document.querySelector(t.selector+" #"+e+"-ads-detail");o&&o.parentNode.removeChild(o)},this.selector=e.selector,document.addEventListener("click",function(e){console.log(e.target),"ads_add_to_cart"===e.target.className&&t.handleAddToCart(e.target.id)})}return t.prototype.handleAddToCart=function(t){return o=this,n=void 0,a=function(){return e(this,function(e){switch(e.label){case 0:return[4,fetch("/v1/creative/addToCart",{credentials:"omit",headers:{"content-type":"application/json"},body:JSON.stringify({listingId:t}),method:"POST",mode:"cors"})];case 1:return e.sent().ok&&window.open("https://www.flipkart.com/viewcart","_blank"),[2]}})},new((i=void 0)||(i=Promise))(function(e,t){function r(e){try{l(a.next(e))}catch(e){t(e)}}function s(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):new i(function(e){e(t.value)}).then(r,s)}l((a=a.apply(o,n||[])).next())});var o,n,i,a},t}(),n=function(){return function(e){var t=this;this.getYPosition=function(e){var t=e-280;return t>10?t:10},this.getXPosition=function(e,t){var o=document.querySelector(t);return e+150>(o?o.offsetWidth:0)-10?e-210:e+30},this.showIcon=function(e,o,n,i){var a=t,r=document.querySelector(t.selector),s=document.createElement("div");s.className="ads-icon",s.id=e,s.innerHTML="+",s.setAttribute("style","position: absolute;border: 4px solid rgba(255, 255, 255, 0.5);border-radius: 20px;width: 30px;height: 30px;color: white;font-size: 20px;font-weight: bold;text-align: center;line-height: 20px;cursor: pointer;left: "+o+"px; top: "+n+"px;animation: shadow-ads-pulse 1s infinite;"),s.addEventListener("click",function(r){t.AdsDetailPopUp.showDetails(e,t.getXPosition(o,a.selector),t.getYPosition(n),i)}),r.appendChild(s)},this.removeIcon=function(e){t.AdsDetailPopUp.removeAdsDetail(e);var o=document.querySelector(t.selector+" #"+e);o&&o.parentNode.removeChild(o)},this.selector=e.selector,this.AdsDetailPopUp=new o({selector:this.selector})}}(),i=function(){return function(e){var t=this;if(this.setAdsData=function(e){t.data=e},this.onReady=function(){switch(console.log("A"+t),document.querySelector(t.selector).setAttribute("style","position: relative;"),t.type.mediaType){case"YOUTUBE_VIDEO":"SHOPPABLE"!==t.type.category&&"ADD_TO_CART"!==t.type.category||t.showAdsOnYouTubeVideo();break;case"IMAGE":"SHOPPABLE"!==t.type.category&&"ADD_TO_CART"!==t.type.category||t.showAdsOnImage();break;case"NATIVE_VIDEO":"SHOPPABLE"!==t.type.category&&"ADD_TO_CART"!==t.type.category||t.showAdsOnNativeVideo()}},this.showAdsOnNativeVideo=function(){t.player=t.type.cbConfig,console.log(t.player)},this.showAdsOnYouTubeVideo=function(){var e=document.createElement("script");e.id="iframe-demo",e.src="https://www.youtube.com/iframe_api";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(e,o),window.onYouTubeIframeAPIReady=t.onYouTubeIframeAPIReady},this.showAdsOnImage=function(){for(var e=0;e<t.data.length;e++){var o=t.data[e];t.AdsIconIns.showIcon(o.id,o.positionPx.left,o.positionPx.top,o.content)}},this.setTimeLookup=function(){var e=t;console.log("INTERVAL"),t.interval=setInterval(function(){for(var t=Math.floor(e.player.getCurrentTime()),o=0;o<e.data.length;o++){var n=e.data[o];t===n.timestamp?(console.log("show"),e.enablePause&&e.player.pauseVideo(),e.AdsIconIns.showIcon(n.id,n.positionPx.left,n.positionPx.top,n.content)):(console.log("remove"),e.AdsIconIns.removeIcon(n.id))}},1e3)},this.onYouTubeIframeAPIReady=function(){var e=document.querySelector(t.selector+" iframe");t.player=new window.YT.Player(e.id,{events:{onReady:t.onPlayerReady,onStateChange:t.onPlayerStateChange}})},this.onPlayerReady=function(){console.log("YouTube player is ready")},this.onPlayerStateChange=function(e){console.log(e),1===e.data?t.setTimeLookup():2===e.data&&clearInterval(t.interval)},console.log(e),this.type={mediaType:e.type.mediaType,category:e.type.category,cbConfig:e.type.cbConfig},this.player=null,this.selector=e.selector,this.interval=null,this.enablePause=e.enablePause,this.AdsIconIns=new n({selector:this.selector}),this.data=[],e.data&&e.data.length)for(var o=0;o<e.data.length;o++){var i=e.data[o],a=i.product_id,r=i.product_details,s=i.timestamp,l=i.topPx,d=i.leftPx;this.data.push({id:"ID-"+a,content:r,timestamp:s,productId:"ID-"+a,positionPx:{top:l,left:d}})}}}();t=window,function(){var e=document.createElement("style"),t=document.head||document.getElementsByTagName("head")[0];e.type="text/css";var o="@keyframes shadow-ads-pulse{0%{box-shadow:0 0 0 0 rgba(255,255,255,.7)}100%{box-shadow:0 0 0 15px transparent}}";e.styleSheet?e.styleSheet.cssText=o:e.appendChild(document.createTextNode(o)),t.appendChild(e)}(),t.ShoppableAds=function(e){return new i(e)}}();
